# ... (mantenha os jobs terraform iguais) ...

  deploy:
    runs-on: ubuntu-latest
    needs: terraform
    env:
      EC2_IP: ${{ needs.terraform.outputs.ec2_ip }}

    steps:
      - name: Checkout do código
        uses: actions/checkout@v3

      - name: Criar chave SSH
        run: |
          echo "${{ secrets.SSH_PRIVATE_KEY }}" > id_rsa
          chmod 600 id_rsa

      - name: Instalar Docker na EC2 (script rápido)
        run: |
          ssh -o StrictHostKeyChecking=no -i id_rsa ubuntu@$EC2_IP "
            # Script rápido de instalação do Docker
            sudo apt-get update
            sudo apt-get install -y docker.io docker-compose
            sudo usermod -aG docker ubuntu
            sudo systemctl start docker
            sudo systemctl enable docker
            echo 'Docker e Docker Compose instalados'
            docker --version
            docker-compose --version
          "

      - name: Copiar aplicação
        run: |
          scp -o StrictHostKeyChecking=no -i id_rsa -r ./ ubuntu@$EC2_IP:/home/ubuntu/app

      - name: Executar Docker Compose
        run: |
          ssh -o StrictHostKeyChecking=no -i id_rsa ubuntu@$EC2_IP "
            cd /home/ubuntu/app
            sudo docker-compose up -d --build
            sleep 5
            sudo docker-compose ps
            echo 'Aplicação disponível em: http://localhost:5000'
          "

      - name: Mostrar URL
        run: |
          echo "Aplicação disponível em: http://$EC2_IP:5000"